<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gym Tracker</title>
    <style>
        canvas {
            display: block;
            border: 1px solid black;
            margin-top: 0px;
        }
    </style>
</head>
<body>
    <input id="uploadInput" type="file">
    <canvas></canvas>
    <script>
        const input = document.getElementById("uploadInput");
        input.addEventListener("change", async(event) => {
            const file = event.target.files[0];
            const data = new FormData();
            data.append("image", file, "image");
            const response = await fetch("/detect", {
                method:"post",
                body: data
            });
            const boxes = await response.json();
            draw_image_and_boxes(file, boxes);
        })
        function draw_image_and_boxes(file, boxes) {
            const img = new Image()
            img.src = URL.createObjectURL(file);
            img.onload = () => {
                const width = 640;
                const height = 640;
                const canvas = document.querySelector("canvas")
                canvas.width = width
                canvas.height = height
                console.log(canvas.width)
                const ctx = canvas.getContext("2d")
                ctx.drawImage(img, 0, 0, height, width);
                ctx.strokeStyle = "#00FF00";
                ctx.lineWidth = 3;
                ctx.font = "18px serif";
                boxes.forEach(([x1, y1, x2, y2, label]) => {
                    x1 = x1/640 * canvas.width
                    x2 = x2/640 * canvas.width
                    y1 = y1/640 * canvas.height
                    y2 = y2/640 * canvas.height

                    ctx.strokeRect(x1, y1,x2-x1, y2-y1);
                    ctx.fillStyle = "#00FF00"
                    const width = ctx.measureText(label).width;
                    ctx.fillRect(x1, y1, width+10, 25);
                    ctx.fillStyle = "#000000";
                    ctx.fillText(label, x1, y1+18);
                })
            }
        }
        
    </script>
</body>
</html>